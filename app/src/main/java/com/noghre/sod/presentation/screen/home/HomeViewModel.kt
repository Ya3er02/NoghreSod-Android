package com.noghre.sod.presentation.screen.home\n\nimport androidx.lifecycle.ViewModel\nimport androidx.lifecycle.viewModelScope\nimport com.noghre.sod.domain.Result\nimport com.noghre.sod.domain.model.ProductCategory\nimport com.noghre.sod.domain.model.ProductSummary\nimport com.noghre.sod.domain.repository.ProductRepository\nimport dagger.hilt.android.lifecycle.HiltViewModel\nimport kotlinx.coroutines.flow.*\nimport kotlinx.coroutines.launch\nimport timber.log.Timber\nimport javax.inject.Inject\n\n/**\n * ViewModel for Home Screen.\n * Manages loading, displaying, and error handling of featured products.\n */\n@HiltViewModel\nclass HomeViewModel @Inject constructor(\n    private val productRepository: ProductRepository\n) : ViewModel() {\n\n    private val _uiState = MutableStateFlow<HomeUiState>(HomeUiState.Loading)\n    val uiState: StateFlow<HomeUiState> = _uiState.asStateFlow()\n\n    init {\n        loadData()\n    }\n\n    /**\n     * Load featured products and categories.\n     */\n    fun loadData() {\n        viewModelScope.launch {\n            _uiState.value = HomeUiState.Loading\n\n            try {\n                // Load featured products\n                productRepository.getProducts(page = 0, pageSize = 10)\n                    .collect { result ->\n                        _uiState.value = when (result) {\n                            is Result.Success -> {\n                                // Filter featured products\n                                val featured = result.data.filter { it.isFeatured }\n\n                                // Get categories\n                                val categories = ProductCategory.entries\n                                    .map { it.displayNameFa }\n\n                                HomeUiState.Success(\n                                    featuredProducts = featured,\n                                    categories = categories\n                                )\n                            }\n                            is Result.Error -> {\n                                Timber.e(\n                                    result.exception,\n                                    \"Failed to load featured products\"\n                                )\n                                HomeUiState.Error(\n                                    message = result.message \u0090?: \"خطا در بارگذاری محصولات\"\n                                )\n                            }\n                            is Result.Loading -> {\n                                HomeUiState.Loading\n                            }\n                        }\n                    }\n            } catch (e: Exception) {\n                Timber.e(e, \"Unexpected error loading home data\")\n                _uiState.value = HomeUiState.Error(\n                    message = \"خطای غیرمنتظره\"\n                )\n            }\n        }\n    }\n}
