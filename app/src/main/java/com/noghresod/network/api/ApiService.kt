package com.noghresod.network.api\n\nimport com.noghresod.network.dto.*\nimport retrofit2.Response\nimport retrofit2.http.*\nimport java.time.Instant\n\n/**\n * API Versioning\n */\nobject ApiVersion {\n    const val V1 = \"v1\"\n    const val V2 = \"v2\"\n    const val CURRENT = V1\n    \n    fun getBaseUrl(version: String = CURRENT): String {\n        return \"https://api.noghresod.ir/$version/\"\n    }\n}\n\n/**\n * ✅ Improved API Service with:\n * - Response<T> wrapper برای بررسی HTTP status\n * - Proper versioning\n * - Idempotency keys\n * - Cursor-based pagination\n */\ninterface ApiService {\n    \n    // ==================== Products ====================\n    \n    @GET(\"products\")\n    suspend fun getAllProducts(\n        @Query(\"page\") page: Int,\n        @Query(\"pageSize\") pageSize: Int,\n        @Query(\"sortBy\") sortBy: String? = null,\n        @Query(\"sortOrder\") sortOrder: String? = null,\n        @Query(\"category\") category: String? = null,\n        @Query(\"minPrice\") minPrice: Long? = null,\n        @Query(\"maxPrice\") maxPrice: Long? = null,\n        @Query(\"inStock\") inStock: Boolean? = null\n    ): Response<ApiResponse<PaginatedResponse<ProductDto>>>\n    \n    @GET(\"products/{id}\")\n    suspend fun getProductById(\n        @Path(\"id\") productId: String\n    ): Response<ApiResponse<ProductDetailDto>>\n    \n    @GET(\"products/search\")\n    suspend fun searchProducts(\n        @Query(\"q\") query: String,\n        @Query(\"page\") page: Int = 1,\n        @Query(\"pageSize\") pageSize: Int = 20,\n        @Query(\"filters\") filters: String? = null\n    ): Response<ApiResponse<PaginatedResponse<ProductDto>>>\n    \n    @GET(\"products/featured\")\n    suspend fun getFeaturedProducts(\n        @Query(\"limit\") limit: Int = 10\n    ): Response<ApiResponse<List<ProductDto>>>\n    \n    @GET(\"products/new\")\n    suspend fun getNewProducts(\n        @Query(\"limit\") limit: Int = 10\n    ): Response<ApiResponse<List<ProductDto>>>\n    \n    @GET(\"products/feed\")\n    suspend fun getProductsFeed(\n        @Query(\"cursor\") cursor: String? = null,\n        @Query(\"limit\") limit: Int = 20\n    ): Response<ApiResponse<PaginatedResponse<ProductDto>>>\n    \n    // ==================== Cart ====================\n    \n    @GET(\"cart\")\n    suspend fun getCart(): Response<ApiResponse<CartDto>>\n    \n    @POST(\"cart/items\")\n    suspend fun addToCart(\n        @Body request: AddToCartRequestDto\n    ): Response<ApiResponse<CartDto>>\n    \n    @PATCH(\"cart/items/{itemId}\")\n    suspend fun updateCartItem(\n        @Path(\"itemId\") itemId: String,\n        @Body request: UpdateCartItemRequestDto\n    ): Response<ApiResponse<CartDto>>\n    \n    @DELETE(\"cart/items/{itemId}\")\n    suspend fun removeFromCart(\n        @Path(\"itemId\") itemId: String\n    ): Response<ApiResponse<CartDto>>\n    \n    @DELETE(\"cart\")\n    suspend fun clearCart(): Response<ApiResponse<Void>>\n    \n    // ==================== Orders ====================\n    \n    @POST(\"orders\")\n    suspend fun createOrder(\n        @Body request: CreateOrderRequestDto,\n        @Header(\"Idempotency-Key\") idempotencyKey: String\n    ): Response<ApiResponse<OrderDto>>\n    \n    @GET(\"orders/{id}\")\n    suspend fun getOrderById(\n        @Path(\"id\") orderId: String,\n        @Query(\"includeItems\") includeItems: Boolean = true\n    ): Response<ApiResponse<OrderDto>>\n    \n    @GET(\"orders\")\n    suspend fun getUserOrders(\n        @Query(\"page\") page: Int,\n        @Query(\"pageSize\") pageSize: Int,\n        @Query(\"status\") status: String? = null,\n        @Query(\"fromDate\") fromDate: String? = null,\n        @Query(\"toDate\") toDate: String? = null\n    ): Response<ApiResponse<PaginatedResponse<OrderDto>>>\n    \n    @PATCH(\"orders/{id}/status\")\n    suspend fun updateOrderStatus(\n        @Path(\"id\") orderId: String,\n        @Body request: UpdateOrderStatusRequestDto\n    ): Response<ApiResponse<OrderDto>>\n    \n    // ==================== Authentication ====================\n    \n    @POST(\"auth/register\")\n    suspend fun register(\n        @Body request: RegisterRequestDto\n    ): Response<ApiResponse<AuthResponseDto>>\n    \n    @POST(\"auth/login\")\n    suspend fun login(\n        @Body request: LoginRequestDto\n    ): Response<ApiResponse<AuthResponseDto>>\n    \n    @POST(\"auth/refresh\")\n    suspend fun refreshToken(\n        @Body request: RefreshTokenRequestDto\n    ): Response<ApiResponse<AuthResponseDto>>\n    \n    @POST(\"auth/logout\")\n    suspend fun logout(): Response<ApiResponse<Void>>\n    \n    // ==================== User ====================\n    \n    @GET(\"users/profile\")\n    suspend fun getUserProfile(): Response<ApiResponse<UserDto>>\n    \n    @PATCH(\"users/profile\")\n    suspend fun updateUserProfile(\n        @Body request: UpdateProfileRequestDto\n    ): Response<ApiResponse<UserDto>>\n    \n    @PATCH(\"users/password\")\n    suspend fun changePassword(\n        @Body request: ChangePasswordRequestDto\n    ): Response<ApiResponse<Void>>\n    \n    // ==================== Categories ====================\n    \n    @GET(\"categories\")\n    suspend fun getCategories(): Response<ApiResponse<List<CategoryDto>>>\n    \n    @GET(\"categories/{id}\")\n    suspend fun getCategoryById(\n        @Path(\"id\") categoryId: String\n    ): Response<ApiResponse<CategoryDto>>\n}\n\n// ==================== DTOs ====================\n\n@kotlinx.serialization.Serializable\ndata class ProductDto(\n    @kotlinx.serialization.SerialName(\"id\")\n    val id: String,\n    \n    @kotlinx.serialization.SerialName(\"name\")\n    val name: String,\n    \n    @kotlinx.serialization.SerialName(\"nameInFarsi\")\n    val nameInFarsi: String,\n    \n    @kotlinx.serialization.SerialName(\"price\")\n    val price: Money,\n    \n    @kotlinx.serialization.SerialName(\"description\")\n    val description: String,\n    \n    @kotlinx.serialization.SerialName(\"category\")\n    val category: String,\n    \n    @kotlinx.serialization.SerialName(\"rating\")\n    val rating: Float = 0f,\n    \n    @kotlinx.serialization.SerialName(\"inStock\")\n    val inStock: Boolean = true,\n    \n    @kotlinx.serialization.SerialName(\"weight\")\n    val weight: Double,\n    \n    @kotlinx.serialization.SerialName(\"createdAt\")\n    @kotlinx.serialization.Serializable(with = InstantSerializer::class)\n    val createdAt: Instant\n)\n\n@kotlinx.serialization.Serializable\ndata class ProductDetailDto(\n    val id: String,\n    val name: String,\n    val nameInFarsi: String,\n    val price: Money,\n    val description: String,\n    val category: String,\n    val rating: Float,\n    val reviews: List<ReviewDto>,\n    val images: List<ImageDto>,\n    val inStock: Boolean,\n    @kotlinx.serialization.Serializable(with = InstantSerializer::class)\n    val createdAt: Instant\n)\n\n@kotlinx.serialization.Serializable\ndata class ReviewDto(\n    val id: String,\n    val rating: Int,\n    val comment: String,\n    val userId: String\n)\n\n@kotlinx.serialization.Serializable\ndata class ImageDto(\n    val id: String,\n    val url: String,\n    val isPrimary: Boolean,\n    val sortOrder: Int\n)\n\n@kotlinx.serialization.Serializable\ndata class CartDto(\n    val id: String,\n    val items: List<CartItemDto>,\n    val total: Money,\n    @kotlinx.serialization.Serializable(with = InstantSerializer::class)\n    val createdAt: Instant\n)\n\n@kotlinx.serialization.Serializable\ndata class CartItemDto(\n    val id: String,\n    val productId: String,\n    val quantity: Int,\n    val price: Money\n)\n\n@kotlinx.serialization.Serializable\ndata class OrderDto(\n    @kotlinx.serialization.SerialName(\"id\")\n    val id: String,\n    \n    @kotlinx.serialization.SerialName(\"orderNumber\")\n    val orderNumber: String,\n    \n    @kotlinx.serialization.SerialName(\"status\")\n    val status: OrderStatus,\n    \n    @kotlinx.serialization.SerialName(\"paymentStatus\")\n    val paymentStatus: PaymentStatus,\n    \n    @kotlinx.serialization.SerialName(\"items\")\n    val items: List<OrderItemDto>,\n    \n    @kotlinx.serialization.SerialName(\"total\")\n    val total: Money,\n    \n    @kotlinx.serialization.SerialName(\"createdAt\")\n    @kotlinx.serialization.Serializable(with = InstantSerializer::class)\n    val createdAt: Instant,\n    \n    @kotlinx.serialization.SerialName(\"estimatedDelivery\")\n    @kotlinx.serialization.Serializable(with = InstantSerializer::class)\n    val estimatedDelivery: Instant?\n)\n\n@kotlinx.serialization.Serializable\ndata class OrderItemDto(\n    val id: String,\n    val productId: String,\n    val productName: String,\n    val quantity: Int,\n    val price: Money\n)\n\n@kotlinx.serialization.Serializable\ndata class UserDto(\n    val id: String,\n    val firstName: String,\n    val lastName: String,\n    val email: String,\n    val phone: String,\n    val avatar: String? = null\n)\n\n@kotlinx.serialization.Serializable\ndata class CategoryDto(\n    val id: String,\n    val name: String,\n    val nameInFarsi: String,\n    val icon: String? = null\n)\n\n// Request DTOs with validation\n@kotlinx.serialization.Serializable\ndata class RegisterRequestDto(\n    @kotlinx.serialization.SerialName(\"email\")\n    val email: String,\n    \n    @kotlinx.serialization.SerialName(\"phone\")\n    val phone: String,\n    \n    @kotlinx.serialization.SerialName(\"password\")\n    val password: String,\n    \n    @kotlinx.serialization.SerialName(\"firstName\")\n    val firstName: String,\n    \n    @kotlinx.serialization.SerialName(\"lastName\")\n    val lastName: String\n) {\n    init {\n        require(email.isNotBlank()) { \"ایمیل نمی‌تواند خالی باشد\" }\n        require(email.isValidEmail()) { \"فرمت ایمیل نامعتبر است\" }\n        require(phone.isNotBlank()) { \"شماره تلفن نمی‌تواند خالی باشد\" }\n        require(phone.isValidIranianPhone()) { \"شماره تلفن نامعتبر است\" }\n        require(password.length >= 8) { \"رمز عبور باید حداقل 8 کاراکتر باشد\" }\n        require(password.hasUpperCase()) { \"رمز عبور باید حداقل یک حرف بزرگ داشته باشد\" }\n        require(password.hasDigit()) { \"رمز عبور باید حداقل یک عدد داشته باشد\" }\n        require(firstName.isNotBlank()) { \"نام نمی‌تواند خالی باشد\" }\n        require(firstName.length >= 2) { \"نام باید حداقل 2 کاراکتر باشد\" }\n    }\n}\n\n@kotlinx.serialization.Serializable\ndata class LoginRequestDto(\n    @kotlinx.serialization.SerialName(\"email\")\n    val email: String,\n    \n    @kotlinx.serialization.SerialName(\"password\")\n    val password: String\n)\n\n@kotlinx.serialization.Serializable\ndata class AuthResponseDto(\n    val accessToken: String,\n    val refreshToken: String,\n    val user: UserDto\n)\n\n@kotlinx.serialization.Serializable\ndata class RefreshTokenRequestDto(\n    val refreshToken: String\n)\n\n@kotlinx.serialization.Serializable\ndata class AddToCartRequestDto(\n    val productId: String,\n    val quantity: Int = 1\n)\n\n@kotlinx.serialization.Serializable\ndata class UpdateCartItemRequestDto(\n    val quantity: Int\n)\n\n@kotlinx.serialization.Serializable\ndata class CreateOrderRequestDto(\n    val cartId: String,\n    val shippingAddressId: String,\n    val paymentMethodId: String\n)\n\n@kotlinx.serialization.Serializable\ndata class UpdateOrderStatusRequestDto(\n    val status: OrderStatus\n)\n\n@kotlinx.serialization.Serializable\ndata class UpdateProfileRequestDto(\n    val firstName: String,\n    val lastName: String,\n    val phone: String\n)\n\n@kotlinx.serialization.Serializable\ndata class ChangePasswordRequestDto(\n    val currentPassword: String,\n    val newPassword: String\n)\n